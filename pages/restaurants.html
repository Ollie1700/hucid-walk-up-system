<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ECIS 2018</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/style.css">

    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
</head>
<body>
    <div id="wrapper">

        <div id="timer" style="opacity:0;">
            <i class="fa fa-clock"></i> <span class="hours"></span>:<span class="minutes"></span><span style="display:none;" class="seconds"></span>
        </div>

        <div class="container-fluid main-container">

            <div class="row main-container-row">

                <div id="sidebar" class="col-1 d-flex flex-column justify-content-between">

                        <div class="sidebar-top">
                                <a href="/dashboard"><img src="/img/ecis-reverse-logo.png"></a>
                                <div class="back">
                                    Back
                                    <span><i class="fas fa-2x fa-long-arrow-alt-left"></i></span>
                                </div>
                        </div>

                    <a id="return-to-index" class="btn btn-light" href="/">
                        <i class="fa fa-cog fa-2x"></i>
                    </a>

                </div>

                <div id="page-content" class="col-11">
                    <div class="inner">
                        <h1 class="page-title">
                            Restaurants
                        </h1>

                        <div class="row ecis-card">
                            <div class="col-4">
                                <p>
                                    <strong>Search By Type</strong>
                                </p>
                                <p>
                                    <select class="custom-select">
                                        <option>Dine-in</option>
                                        <option>Takeaway</option>
                                    </select>
                                </p>
                            </div>
                            <div class="col-4">
                                <p>
                                    <strong>Search By Location</strong>
                                </p>
                                <p>
                                    <select class="custom-select">
                                        <option>Within 0.5 miles</option>
                                        <option>Within 0.5 miles</option>
                                        <option>Within 0.5 miles</option>
                                        <option>Within 0.5 miles</option>
                                        <option>Within 0.5 miles</option>
                                        <option>Within 0.5 miles</option>
                                    </select>
                                </p>
                            </div>
                            <div class="col-4">
                                <p>
                                    <strong>Search By Closing Time</strong>
                                </p>
                                <p>
                                    <select class="custom-select">
                                        <option>10pm</option>
                                        <option>10pm</option>
                                        <option>10pm</option>
                                        <option>10pm</option>
                                        <option>10pm</option>
                                    </select>
                                </p>
                            </div>
                        </div>

                        <div class="row num-results-row">
                            <div class="col-12 text-center">
                                <strong>10 talks found:</strong>
                            </div>
                        </div>

                        <div id="results-container">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- /#wrapper -->
    <!-- END BODY CONTENT -->
    <!-- JS -->
    <script>
        const container = document.getElementById('results-container')
        let myLocationLat, myLocationLng
        function getCurrentLocation() {
            // Asynchronously grabs the current location of the walk up system and pass those values into a map initalizer function
            navigator.geolocation.getCurrentPosition((position) => {
                myLocationLat = position.coords.latitude
                myLocationLng = position.coords.longitude
                const currentLocation = {lat: myLocationLat, lng: myLocationLng}
                initPlaces(currentLocation)
            })
        }

        function setCoords() {
            // Initialise latitude and longitude array
            let latAndLng = [];
            // Traverse to parent of button click
            const parent = this.parentNode.parentNode;
            // Get lat and long values from element's dataset attributes
            const lat = parent.dataset.lat;
            const lng = parent.dataset.lng;
            // Push lat and long to array
            latAndLng.push({lat, lng});
            // Set local storage coordinates equal to the values held in latAndLng Array
            localStorage.setItem('coords', JSON.stringify(latAndLng));
        }
        let service
        let request
        function initPlaces(currentLocation) {
            service = new google.maps.places.PlacesService(document.createElement('div'));
            request = {
                location: currentLocation,
                radius: '804',
                type: ['restaurant']
            }
            service.nearbySearch(request, callback)
        }

        function callback(results, status) {
            if(status = google.maps.places.PlacesServiceStatus.OK) {
                container.innerHTML = results.map((result, i) => {
                    const currentlyOpen = result.opening_hours.open_now ? 'open' : 'closed'
                    return `
                    <div class="row">
                            <div class="col-12 col-md-8 offset-md-2 ecis-card">
                                <h2>${result.name}</h2>
                                <p>
                                    <strong>Address:</strong> ${result.vicinity}
                                </p>
                                <p>
                                    <strong>Rating:</strong> ${result.rating}
                                </p>
                                <p>
                                    Currently <span class="${currentlyOpen}">${currentlyOpen}
                                </p>
                                <p class="d-flex align-items-center justify-content-between">
                                    <a href="/map" class="btn btn-primary directions">Get Directions <i class="fa fa-chevron-right"></i></a>
                                    <a href="/email" class="btn btn-warning">Send To Email <i class="fa fa-paper-plane"></i></a>
                                </p>
                            </div>
                        </div>
                    `
                })

            }
        }

        function filterRadius() {

        }

        function filterHours() {

        }

        // Get select menus
        const selectRadius = document.querySelector('.select-topic')
        const selectHours = document.querySelector('.select-hours')

        // Select Menu Event Listeners
        selectRadius.addEventListener('change', filterRadius)
        selectHours.addEventListener('change', filterHours)

        // Get every button with the class 'directions'
        const directionButtons = document.querySelectorAll('.directions')
        // Bind an click listener to each button. When any button is clicked, call setCoords
        directionButtons.forEach(button => button.addEventListener('click', setCoords))

    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDBskp6IOMHWbypxVLxH6SPpnyeSxz3NNQ&libraries=places&callback=getCurrentLocation" async defer></script>
    <script src="http://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="/js/ecis.js"></script>
</body>
</html>